spring:
  application:
    name: werkflow-admin-service

  datasource:
    url: jdbc:postgresql://${POSTGRES_HOST:localhost}:${POSTGRES_PORT:5433}/${POSTGRES_DB:werkflow}
    username: ${POSTGRES_USER:werkflow_admin}
    password: ${POSTGRES_PASSWORD:secure_password_change_me}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        default_schema: ${SPRING_DATASOURCE_SCHEMA:admin_service}
        format_sql: true
        jdbc:
          time_zone: UTC
    show-sql: ${JPA_SHOW_SQL:false}

  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration
    schemas: ${SPRING_DATASOURCE_SCHEMA:admin_service}
    default-schema: ${SPRING_DATASOURCE_SCHEMA:admin_service}

  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${KEYCLOAK_URL:http://localhost:8090}/realms/${KEYCLOAK_REALM:werkflow}
          jwk-set-uri: ${KEYCLOAK_URL:http://localhost:8090}/realms/${KEYCLOAK_REALM:werkflow}/protocol/openid-connect/certs

server:
  port: ${SERVER_PORT:8083}
  servlet:
    context-path: /
  error:
    include-message: always
    include-stacktrace: on_param

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    export:
      prometheus:
        enabled: true

logging:
  level:
    com.werkflow.admin: ${LOG_LEVEL:INFO}
    org.springframework.security: ${SECURITY_LOG_LEVEL:INFO}
    org.hibernate.SQL: ${SQL_LOG_LEVEL:WARN}
    org.flywaydb: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    operations-sorter: method
    tags-sorter: alpha
  show-actuator: true

app:
  name: ${APP_NAME:Werkflow Admin Service}
  version: ${APP_VERSION:1.0.0}
  environment: ${APP_ENVIRONMENT:development}

  keycloak:
    enabled: ${KEYCLOAK_ENABLED:true}
    realm: ${KEYCLOAK_REALM:werkflow}
    auth-server-url: ${KEYCLOAK_URL:http://localhost:8090}
    issuer-uri: ${KEYCLOAK_URL:http://localhost:8090}/realms/${KEYCLOAK_REALM:werkflow}

  cors:
    allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:4000,http://localhost:4001}
    allowed-methods: GET,POST,PUT,DELETE,OPTIONS,PATCH
    allowed-headers: "*"
    allow-credentials: true
    max-age: 3600

  routes:
    /studio: HR_ADMIN,ADMIN,SUPER_ADMIN
    /studio/**: HR_ADMIN,ADMIN,SUPER_ADMIN
    /services: SERVICE_ADMIN,ADMIN,SUPER_ADMIN
    /services/**: SERVICE_ADMIN,ADMIN,SUPER_ADMIN
    /admin: ADMIN,SUPER_ADMIN
    /admin/**: ADMIN,SUPER_ADMIN
