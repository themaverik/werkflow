spring:
  application:
    name: werkflow-finance-service

  datasource:
    url: jdbc:postgresql://${POSTGRES_HOST:localhost}:${POSTGRES_PORT:5433}/${POSTGRES_DB:werkflow}
    username: ${POSTGRES_USER:werkflow_admin}
    password: ${POSTGRES_PASSWORD:secure_password_change_me}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        default_schema: ${SPRING_DATASOURCE_SCHEMA:finance_service}
        format_sql: true
        jdbc:
          time_zone: UTC
    show-sql: ${JPA_SHOW_SQL:false}

  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration
    schemas: ${SPRING_DATASOURCE_SCHEMA:finance_service}
    default-schema: ${SPRING_DATASOURCE_SCHEMA:finance_service}

  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: ${KEYCLOAK_URL:http://localhost:8090}/realms/${KEYCLOAK_REALM:werkflow}
          jwk-set-uri: ${KEYCLOAK_URL:http://localhost:8090}/realms/${KEYCLOAK_REALM:werkflow}/protocol/openid-connect/certs

server:
  port: ${SERVER_PORT:8085}
  servlet:
    context-path: /
  error:
    include-message: always
    include-stacktrace: on_param

# External Service URLs
services:
  admin:
    url: ${ADMIN_SERVICE_URL:http://localhost:8083}
  engine:
    url: ${ENGINE_SERVICE_URL:http://localhost:8081}
  inventory:
    url: ${INVENTORY_SERVICE_URL:http://localhost:8084}

# Business Rules
finance:
  auto-approval-threshold: ${AUTO_APPROVAL_THRESHOLD:100.00}
  expense-retention-days: ${EXPENSE_RETENTION_DAYS:2555}

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized
  metrics:
    export:
      prometheus:
        enabled: true

logging:
  level:
    com.werkflow.finance: ${LOG_LEVEL:INFO}
    org.springframework.security: ${SECURITY_LOG_LEVEL:INFO}
    org.hibernate.SQL: ${SQL_LOG_LEVEL:WARN}
    org.flywaydb: INFO

springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    operations-sorter: method
    tags-sorter: alpha
  show-actuator: true
